
# Use official Node.js 20 slim image as base
FROM node:20-slim

# Set maintainer label
LABEL maintainer="it241504@ustp-students.at"

# Avoid interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Update and upgrade system packages
RUN apt update && apt upgrade -y

# install curl for the nestjs healthcheck
RUN apt install curl -y

# Set working directory inside the container
WORKDIR /usr/src/app

# Install global npm and typeorm
RUN npm i -g npm@11 typeorm

# Copy package files for dependency installation
COPY package*.json ./

# Install dependencies using npm ci for clean install
RUN npm ci

# Copy all project files into the container
COPY . .

# Build the application
RUN npm run build